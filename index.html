<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>SensiTrack</title>
    
    <meta name="theme-color" content="#5c6bc0"> 
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW enregistrÃ© !'))
                    .catch(err => console.error('SW Erreur:', err));
            });
        }
    </script>
</head>
<body>

    <header class="app-header">
        <div class="brand">SensiTrack</div>
        <div id="save-status" class="status-dot"></div>
        <button id="theme-toggle" class="theme-switch">
            <span class="icon-sun">â˜€ï¸</span>
            <span class="icon-moon">ğŸŒ™</span>
        </button>
    </header>

    <section class="control-zone">
        <div class="row">
            <div class="input-group">
                <input type="date" id="global-date">
                <input type="time" id="global-time">
            </div>
            <div class="input-group">
                <select id="cycle-selector-ui"></select>
                <div class="cycle-actions">
                    <input type="date" id="cycle-start-edit-picker" style="display:none">
                    <input type="date" id="new-cycle-picker" style="display:none">
                    
                    <button id="btn-edit-cycle-date" class="btn-mini" title="Modifier date cycle">ğŸ“…</button>
                    <button id="btn-delete-cycle" class="btn-mini" title="Supprimer cycle" style="color: var(--danger); border-color: var(--danger);">ğŸ—‘ï¸</button>
                    <button id="btn-add-cycle-main" class="btn-mini btn-primary" title="Nouveau cycle">â•</button>
                </div>
            </div>
        </div>
        <div id="cycle-info-display" class="cycle-badge">Chargement...</div>
        
        <div style="margin-top: 10px; border-top: 1px solid var(--border); padding-top: 10px;">
            <button id="btn-enable-autosave" class="btn-mini" style="width:100%; border-color: var(--primary); color: var(--primary);">
                ğŸ’¾ Activer sauvegarde auto (Fichier)
            </button>
            <div id="autosave-msg" style="font-size: 0.75rem; color: green; margin-top: 5px; display:none;">
                âœ… Sauvegarde auto active
            </div>
        </div>
    </section>

    <nav class="tab-bar">
        <button class="tab-btn active" data-target="temp-panel">Temp</button>
        <button class="tab-btn" data-target="mucus-panel">Glaire</button>
        <button class="tab-btn" data-target="perturb-panel">Infos</button>
        <button class="tab-btn" data-target="history-panel">Histo</button>
        <button class="tab-btn" data-target="cycles-panel">Cycles</button>
    </nav>

    <main class="content">
        <section id="temp-panel" class="panel active">
            <div class="temp-display-large" id="temp-val-display">36.30Â°C</div>
            <div class="wheels-container">
                <div class="wheel-wrapper">
                    <div id="wheel-int" class="wheel-content"></div>
                </div>
                <div class="wheel-separator">.</div>
                <div class="wheel-wrapper">
                    <div id="wheel-dec1" class="wheel-content"></div>
                </div>
                <div class="wheel-wrapper">
                    <div id="wheel-dec2" class="wheel-content"></div>
                </div>
            </div>
            <button id="btn-validate-temp" class="btn-main-action">âœ“ Valider la tempÃ©rature</button>
        </section>

        <section id="mucus-panel" class="panel">
            <div style="background: rgba(255, 193, 7, 0.1); border-left: 4px solid #ffc107; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem;">
                âš ï¸ <strong>Important :</strong> Enregistrez soit des saignements, soit une observation de glaire (pas les deux en mÃªme temps)
            </div>

            <h3 style="font-size: 0.9rem; font-weight: 700; text-transform: uppercase; opacity: 0.7; margin: 20px 0 10px;">Saignements</h3>
            <div class="mucus-grid">
                <label class="radio-card"><input type="radio" name="bleeding" value="none" checked> âˆ… Aucun</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="spotting"> ğŸ©¸ Spotting</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="medium"> ğŸ©¸ğŸ©¸ Moyen</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="heavy"> ğŸ©¸ğŸ©¸ğŸ©¸ Abondant</label>
            </div>

            <hr style="border: 0; border-top: 1px solid var(--border); margin: 25px 0;">
            
            <h3 style="font-size: 0.9rem; font-weight: 700; text-transform: uppercase; opacity: 0.7; margin: 20px 0 10px;">Sensation de glaire</h3>
            <div class="mucus-grid">
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="rien"> âˆ… Rien</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="seche"> ğŸœï¸ SÃ¨che</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="humide"> ğŸ’§ Humide</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="mouillee"> ğŸŒŠ MouillÃ©e</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="glissante"> â›¸ï¸ Glissante</label>
            </div>

            <h3 style="font-size: 0.9rem; font-weight: 700; text-transform: uppercase; opacity: 0.7; margin: 20px 0 10px;">Aspect de la glaire</h3>
            <div class="mucus-grid">
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="rien"> âˆ… Rien</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="cremeux"> ğŸ¥› CrÃ©meux</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="jaunatre"> ğŸŸ¡ JaunÃ¢tre</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="blanc_oeuf"> ğŸ¥š Blanc d'Å“uf</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="filant"> ğŸ§µ Filant</label>
            </div>

            <button id="btn-validate-mucus" class="btn-main-action" style="margin-top:20px;">âœ“ Valider</button>
        </section>

        <section id="perturb-panel" class="panel">
            <label class="check-card special">
                <input type="checkbox" id="manual-exclude-temp"> ğŸš« Exclure cette mesure
            </label>
            <div class="perturbations-list">
                <label class="check-card"><input type="checkbox" id="p-sleep"> ğŸ’¤ Sommeil</label>
                <label class="check-card"><input type="checkbox" id="p-alcohol"> ğŸ· Alcool</label>
                <label class="check-card"><input type="checkbox" id="p-illness"> ğŸ¤’ Maladie</label>
                <label class="check-card"><input type="checkbox" id="p-stress"> âš¡ Stress</label>
                <label class="check-card"><input type="checkbox" id="p-late"> â° Prise tardive</label>
            </div>
        </section>

        <section id="history-panel" class="panel">
            <ul id="history-list"></ul>
        </section>
        
        <section id="cycles-panel" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 1.3rem; font-weight: 700;">Mes cycles</h2>
            </div>
            <div id="cycles-list"></div>
        </section>

        <div class="chart-action-zone">
            <button id="btn-open-chart" class="btn-chart-access">
                <span class="chart-icon">ğŸ“ˆ</span>
                <span class="chart-text">Voir mon graphique complet</span>
                <span class="chart-sub">Mode paysage</span>
            </button>
        </div>

        <div id="full-screen-chart-overlay" class="chart-overlay hidden">
            <div class="overlay-header">
                <button id="btn-close-chart" class="btn-close">ğŸ  Retour Accueil</button>
                <div class="rotation-hint">Pivotez votre Ã©cran â†»</div>
            </div>
            <div class="canvas-scroll-container">
                <canvas id="paperChartCanvas"></canvas>
            </div>
        </div>
    </main>

    <script type="module" src="js/app.js"></script>
</body>
</html>