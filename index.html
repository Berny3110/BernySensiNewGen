<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>SensiTrack</title>
    
    <meta name="theme-color" content="#5c6bc0"> 
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW enregistrÃ© !'))
                    .catch(err => console.error('SW Erreur:', err));
            });
        }
    </script>
</head>
<body>

    <header class="app-header">
        <div class="header-row-1">
            <div class="brand">SensiTrack</div>
            <div class="cycle-nav-compact">
                <button id="btn-prev-cycle" class="cycle-arrow" title="Cycle prÃ©cÃ©dent">â€¹</button>
                <div id="cycle-display-compact" class="cycle-label">Cycle #1</div>
                <button id="btn-next-cycle" class="cycle-arrow" title="Cycle suivant">â€º</button>
            </div>
            <button id="theme-toggle" class="theme-switch">
                <span class="icon-sun">â˜€ï¸</span>
                <span class="icon-moon">ğŸŒ™</span>
            </button>
        </div>
        
        <div class="header-row-2">
            <input type="date" id="global-date">
            <input type="time" id="global-time">
        </div>
    </header>

    <nav class="tab-bar">
        <button class="tab-btn active" data-target="temp-panel">Temp</button>
        <button class="tab-btn" data-target="mucus-panel">Glaire</button>
        <button class="tab-btn" data-target="perturb-panel">Infos</button>
        <button class="tab-btn" data-target="history-panel">Histo</button>
        <button class="tab-btn" data-target="cycles-panel">Cycles</button>
    </nav>

    <main class="content">
        <section id="temp-panel" class="panel active">
            <div class="temp-display-large" id="temp-val-display">36.30Â°C</div>
            <div class="wheels-container">
                <div class="wheel-wrapper">
                    <div id="wheel-int" class="wheel-content"></div>
                </div>
                <div class="wheel-separator">.</div>
                <div class="wheel-wrapper">
                    <div id="wheel-dec1" class="wheel-content"></div>
                </div>
                <div class="wheel-wrapper">
                    <div id="wheel-dec2" class="wheel-content"></div>
                </div>
            </div>
            <button id="btn-validate-temp" class="btn-main-action">âœ“ Valider la tempÃ©rature</button>
        </section>

        <section id="mucus-panel" class="panel">
            <h3 class="section-title">Saignements</h3>
            <div class="mucus-grid-compact">
                <label class="radio-card"><input type="radio" name="bleeding" value="none" checked> âˆ… Aucun</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="spotting"> ğŸ’‰ Spotting</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="light"> ğŸ©¸ LÃ©ger</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="medium"> ğŸ©¸ğŸ©¸ Moyen</label>
                <label class="radio-card"><input type="radio" name="bleeding" value="heavy"> ğŸ©¸ğŸ©¸ğŸ©¸ Abondant</label> 
            </div>

            <hr class="section-divider">
            
            <h3 class="section-title" id="mucus-sensation-title">Sensation de glaire</h3>
            <div class="mucus-grid-compact" id="mucus-sensation-grid">
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="rien"> âˆ… Rien</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="seche"> ğŸŒµ SÃ¨che</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="humide"> ğŸ’§ Humide</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="mouillee"> ğŸ’¦ MouillÃ©e</label>
                <label class="radio-card"><input type="radio" name="mucus-sensation" value="glissante"> â›¸ï¸ Glissante</label>
            </div>

            <h3 class="section-title" id="mucus-aspect-title">Aspect de la glaire</h3>
            <div class="mucus-grid-compact" id="mucus-aspect-grid">
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="rien"> âˆ… Rien</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="cremeux"> ğŸ¥› CrÃ©meux</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="jaunatre"> ğŸŸ¡ JaunÃ¢tre</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="blanc_oeuf"> ğŸ¥š Blanc d'Å“uf</label>
                <label class="radio-card"><input type="radio" name="mucus-aspect" value="filant"> ğŸ§µ Filant</label>
            </div>

            <button id="btn-validate-mucus" class="btn-main-action">âœ“ Valider</button>
        </section>

        <section id="perturb-panel" class="panel">
            <label class="check-card special">
                <input type="checkbox" id="manual-exclude-temp"> ğŸš« Exclure cette mesure
            </label>
            <div class="perturbations-grid">
                <label class="check-card"><input type="checkbox" id="p-sleep"> ğŸ’¤ Sommeil</label>
                <label class="check-card"><input type="checkbox" id="p-alcohol"> ğŸ· Alcool</label>
                <label class="check-card"><input type="checkbox" id="p-illness"> ğŸ¤’ Maladie</label>
                <label class="check-card"><input type="checkbox" id="p-stress"> âš¡ Stress</label>
                <label class="check-card"><input type="checkbox" id="p-late"> â° Prise tardive</label>
            </div>
        </section>

        <section id="history-panel" class="panel">
            <ul id="history-list"></ul>
        </section>
        
        <section id="cycles-panel" class="panel">
            <div class="cycles-header">
                <h2>Gestion des cycles</h2>
                <button id="btn-add-cycle-main" class="btn-primary-small">â• Nouveau cycle</button>
            </div>
            
            <div class="new-cycle-form" id="new-cycle-form" style="display:none;">
                <input type="date" id="new-cycle-picker">
                <button id="btn-confirm-new-cycle" class="btn-primary-small">CrÃ©er</button>
                <button id="btn-cancel-new-cycle" class="btn-secondary-small">Annuler</button>
            </div>
            
            <div class="cycles-table-container">
                <table class="cycles-table">
                    <thead>
                        <tr>
                            <th>NÂ°</th>
                            <th>Date dÃ©but</th>
                            <th>DurÃ©e</th>
                            <th>EntrÃ©es</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="cycles-table-body">
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- FAB : Bouton flottant pour le graphique -->
    <button id="btn-open-chart" class="fab-chart" title="Voir le graphique">
        ğŸ“ˆ
    </button>

    <!-- Overlay du graphique -->
    <div id="full-screen-chart-overlay" class="chart-overlay hidden">
        <div class="overlay-header">
            <button id="btn-close-chart" class="btn-close">ğŸ  Retour</button>
            <div class="zoom-controls">
                <button id="btn-zoom-out" class="zoom-btn">â–</button>
                <button id="btn-zoom-reset" class="zoom-btn">â†»</button>
                <button id="btn-zoom-in" class="zoom-btn">â•</button>
            </div>
        </div>
        <div class="canvas-scroll-container" id="canvas-scroll-container">
            <canvas id="paperChartCanvas"></canvas>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>